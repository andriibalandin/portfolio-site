{% extends 'shop/base.html' %}
{% block content %}
  <h1>Профіль користувача {{ user.username }}</h1>
  {% if user != request.user %}
    {% if user.userprofile in request.user.userprofile.followed_authors.all %}
      <a href="{% url 'users:unfollow_author' user.id %}">Відписатися</a>
    {% else %}
      <a href="{% url 'users:follow_author' user.id %}">Підписатися</a>
    {% endif %}
  {% endif %}
  {% if user.userprofile.avatar %}
    <img src="{{ user.userprofile.avatar.url }}" alt="Аватар">
  {% else %}
    <p>Аватар відсутній</p>
  {% endif %}
  {% if request.user == user %}
  {% if user_subscription %}
        <p>Підписка: {{ user_subscription.plan|capfirst }} (активна до {{ user_subscription.end_date }})</p>
    {% else %}
        <p>У вас немає активної підписки.</p>
        <a href="{% url 'users:subscribe' %}" class="button">Оформити підписку</a>
    {% endif %}
    <a href="{% url 'users:edit_profile' %}">Редагувати профіль</a>
  <p><a href="{% url 'blog:posts' %}?only_followed=True">Пости відстежуваних авторів</a></p>
  <h3>Відстежуємі продукти</h3>
  {% for tracked in tracked_products %}
    <p>
      <a href="{{ tracked.product.get_absolute_url }}">{{ tracked.product.name }}</a> 
      - {% if tracked.product.is_available and tracked.product.quantity > 0 %}В наявності ({{ tracked.product.quantity }} шт.){% else %}Немає в наявності{% endif %}
      <a href="{% url 'shop:track_product' tracked.product.slug %}" class="button">Припинити відстежування</a>
    </p>
  {% empty %}
    <p>Відстежуємі продукти відсутні.</p>
  {% endfor %}
  {% endif %}
{% endblock %}